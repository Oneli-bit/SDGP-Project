name: Android CI/CD

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
    
  workflow_dispatch:

jobs:
  build-and-deploy:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2 #clone

    - name: Set up JDK 18
      uses: actions/setup-java@v2
      with:
        java-version: '18'
        distribution: 'adopt'
        
    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: '3.x'
        
    - name: Setup Android SDK
      uses: android-actions/setup-android@v2
      with:
        sdk-version: '31'
        ndk-version: '21.4.7075529'
        build-tools-version: '31.0.0'
        licenses: ${{ secrets.ANDROID_LICENSES }}
        
    - name: Add ./gradlew to PATH
      run: echo "::set-env name=PATH::$(pwd):$PATH"
    
    - name: Run ./gradlew assembleDebug
      run: ./gradlew assembleDebug
        
    - name: Create project directory
      run: mkdir path/to/project 
      
    - name: Build debug APK
      run: ./gradlew assembleDebug

    - name: Run unit tests
      run: ./gradlew testDebugUnitTest

    - name: Run UI tests
      run: ./gradlew connectedDebugAndroidTest

    - name: Check code quality
      run: ./gradlew lintDebug

    - name: Upload test results
      uses: actions/upload-artifact@v2
      with:
          name: test-results
          path: |
            app/build/reports/tests/testDebugUnitTest
            app/build/reports/androidTests/connected/flavors/Debug/index.html
            app/build/reports/lint-results.xml
      


      
 

 
